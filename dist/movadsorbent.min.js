class Movadsorbent { lastStop = { left: 0, bottom: 0 }; curStop = { left: 0, bottom: 0 }; constructor(t, e = null) { this.player = t, this.event = e, this.initPlayerStyle(), this.initControllerBar(), this.initNote(), this.initPlayerEvent(), this.consoleInfo() } initPlayerStyle() { document.querySelector(".aplayer-body").style.transition = "none", document.querySelector(".aplayer-list").style.border = "none" } initControllerBar() { let t = document.querySelector(".aplayer-miniswitcher"), e = t.parentNode || t.parentElement; e.removeChild(t), t = document.createElement("div"), t.className = "aplayer-miniswitcher", e = e.appendChild(t), this.initPlayerMove(t), t = document.createElement("div"), t.className = "ctrl-bar", e.appendChild(t), this.initMinimizeButton(t), this.initMaximizeButton(t), this.initCloseButton(t) } initMinimizeButton(t) { let e = document.createElement("span"); e.className = "ctrl-btn minimize", e.addEventListener("click", (t => { this.minimizePlayer(), t.stopPropagation() })), t.appendChild(e) } initMaximizeButton(t) { let e = document.createElement("span"); e.className = "ctrl-btn maximize", e.addEventListener("click", (t => { this.maximizePlayer(t), t.stopPropagation() })), t.appendChild(e) } initCloseButton(t) { let e = document.createElement("span"); e.className = "ctrl-btn close", e.addEventListener("click", (t => { this.player.destroy(), t.stopPropagation() })), t.appendChild(e) } initPlayerMove(t) { let e = document.createElement("div"); e.className = "move-box", e.addEventListener("mousedown", (t => { document.body.style.cursor = "move"; let e = document.querySelector(".aplayer-fixed"), o = document.querySelector(".aplayer-body"), i = e.style.left.replace("px", "") || "0", l = e.style.bottom.replace("px", "") || "0", n = t.clientX - parseInt(i), s = document.body.clientHeight - t.clientY - parseInt(l); window.onmousemove = t => { this.movePlayer(t, e, o, n, s) }, window.onmouseup = t => { document.body.style.cursor = "default", this.playerStop(t), this.noteAutoControl(), window.onmousemove = window.onmouseup = void 0 } })), t.appendChild(e) } initPlayerEvent() { this.player.on("listshow", (() => setTimeout((() => this.playerStop()), 500))), this.player.on("play", (() => this.noteAutoControl())), this.player.on("pause", (() => this.noteAutoControl())) } movePlayer(t, e, o, i, l) { this.event = t || window.event || this.event; let n = this.event.clientX - i, s = document.body.clientHeight - this.event.clientY - l; this.curStop.left = n, this.curStop.bottom = s, e.style.left = o.style.left = n + "px", e.style.bottom = o.style.bottom = s + "px" } playerStop(t) { let e, o, i = document.querySelector(".aplayer-fixed"), l = document.querySelector(".aplayer-body"), n = Math.max(66, l.clientWidth) + 18, s = Math.max(66, i.clientHeight); this.curStop.bottom < 16 ? e = "0" : this.curStop.bottom + s + 16 > document.body.clientHeight && (e = document.body.clientHeight - s), e && (i.style.bottom = l.style.bottom = e + "px"), this.curStop.left < 16 ? o = "0" : this.curStop.left + n + 16 > document.body.clientWidth && (o = document.body.clientWidth - n + 18), o && (i.style.left = l.style.left = o + "px"), (e || o) && (this.event = t || window.event || this.event, this.curStop.bottom = this.lastStop.bottom = e || document.body.clientHeight - this.event.clientY - s, this.curStop.left = this.lastStop.left = o || this.event.clientX - n) } minimizePlayer() { if (this.setPlayerMode("mini"), this.curStop.left + "" == "0" && this.curStop.bottom + "" == "0") return; let t = document.querySelector(".aplayer-fixed"), e = document.querySelector(".aplayer-body"); t.style.background = "none", e.style.transition = "all .5s ease", t.style.left = e.style.left = "0px", t.style.bottom = e.style.bottom = "0px", this.lastStop = { ...this.curStop }, this.curStop.left = this.curStop.bottom = 0, setTimeout((() => { e.style.transition = "none", this.noteAutoControl() }), 500) } maximizePlayer(t) { this.setPlayerMode("mini" === this.player.mode ? "normal" : "mini"); let e = document.querySelector(".aplayer-fixed"), o = document.querySelector(".aplayer-body"); o.style.transition = "all .5s ease", e.style.background = "#fff", this.curStop.left + "" == "0" && this.curStop.bottom + "" == "0" && (e.style.left = o.style.left = this.lastStop.left + "px", e.style.bottom = o.style.bottom = this.lastStop.bottom + "px", this.curStop = { ...this.lastStop }), setTimeout((() => { o.style.transition = "none", this.noteAutoControl(), this.playerStop(t) }), 500) } initNote() { let t = document.createElement("div"); t.className = "note-container"; let e = this.curStop.left > document.body.clientWidth >> 1 ? "note-move-right" : "note-move-left"; for (let o = 1; o < 4; o++) { let i = document.createElement("div"); i.id = "note" + o, i.className = "note", i.innerHTML = '<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="32" height="32"><path d="M1023.962 64.037c0-43.42-42.2-74.019-83.199-61.019L300.795 192.015c-26.6 8.4-44.8 33-44.8 60.999v522.83c-20.1-4.76-41.439-7.84-63.998-7.84C85.958 768.005 0 825.305 0 896.003S85.958 1024 191.997 1024s191.996-57.299 191.996-127.998V428.631l511.991-150.038v369.254c-20.1-4.76-41.44-7.84-63.999-7.84-106.038 0-191.996 57.299-191.996 127.998s85.958 127.997 191.996 127.997 191.997-57.299 191.997-127.997l-.02-703.968z"/></svg>', i.querySelector("svg path").style.fill = this.randomRGBColor(), i.style.animationName = e + o, t.appendChild(i) } document.querySelector(".aplayer-pic").appendChild(t) } noteAutoControl() { let t = document.querySelector(".note-container"); if (t) { t.className = this.player.audio.paused ? "note-container" : "note-container playing"; let e = this.curStop.left > document.body.clientWidth >> 1 ? "note-move-right" : "note-move-left"; for (let t = 1; t < 4; t++) { let o = document.getElementById("note" + t); o.style.animationName = e + t, this.player.audio.paused || (o.querySelector("svg path").style.fill = this.randomRGBColor()) } } else this.initNote(), this.player.audio.paused || (document.querySelector(".note-container").className = "note-container playing") } setPlayerMode(t = "normal") { let e = document.querySelector(".aplayer-list"), o = e.querySelector("ol"); if (e.style.display = "block", "normal" === t) { let t = this.player.options.listMaxHeight; e.style.maxHeight = t || "250px", o.style.maxHeight = t || "250px" } else e.style.maxHeight = "0px", o.style.maxHeight = "0px"; this.player.setMode(t) } randomRGBColor() { return "rgb(" + Math.round(236 * Math.random()) + "," + Math.round(236 * Math.random()) + "," + Math.round(236 * Math.random()) + ")" } consoleInfo(){console.log('\n %c APlayer-Control-Bar-Plugin %c https://github.com/snwjas/Aplayer-ControlBarPlugin \n','color: #fadfa3; background: #030307; padding:5px 0;','background: #fadfa3; padding:5px 0;')} }