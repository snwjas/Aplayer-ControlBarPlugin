"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor){descriptor.writable=true}Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps){defineProperties(Constructor.prototype,protoProps)}if(staticProps){defineProperties(Constructor,staticProps)}return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Movadsorbent=function(){function Movadsorbent(aplayer,showNote,event){_classCallCheck(this,Movadsorbent);this.lastStop={left:0,bottom:0};this.curStop={left:0,bottom:0};this.player=aplayer;this.showNote=showNote;this.event=event;this.$ap=aplayer.container;this.$apBody=aplayer.container.querySelector(".aplayer-body");this.$apList=aplayer.container.querySelector(".aplayer-list");this.initPlayerStyle();this.initControllerBar();this.initNote();this.initPlayerEvent();this.consoleInfo()}_createClass(Movadsorbent,[{key:"initPlayerStyle",value:function initPlayerStyle(){this.$apBody.style.transition="padding .25s";this.$apList.style.border="none";var css=".aplayer.aplayer-fixed .aplayer-body{padding-right:0;}.aplayer.aplayer-fixed .aplayer-miniswitcher{background:#eee;opacity:0;visibility:hidden;transition:all 0.25s;}.aplayer.aplayer-fixed:hover .aplayer-body{padding-right:18px;}.aplayer.aplayer-fixed:hover .aplayer-miniswitcher{opacity:1;visibility:visible;}.acbp-move-box{width:100%;height:100%;position:absolute;left:0;top:0;cursor:move;}.acbp-ctrl-bar{width:100%;height:100%;display:flex;flex-direction:column;justify-content:space-around;align-items:center;}.acbp-ctrl-bar .acbp-ctrl-btn{display:inline-block;margin:0 auto;width:10px;height:10px;border-radius:50%;cursor:pointer;flex-shrink:0;z-index:999;transition:opacity 0.25s;opacity:0.41;}.acbp-ctrl-bar .acbp-ctrl-btn:hover{opacity:1;}.acbp-ctrl-bar .acbp-ctrl-btn.minimize{background-color:#00BBCD;}.acbp-ctrl-bar .acbp-ctrl-btn.maximize{background-color:#1BB775;}.acbp-ctrl-bar .acbp-ctrl-btn.close{background-color:#E42D54;}.acbp-note-container{width:30px;height:30px;position:absolute;right:50%;bottom:50%;margin:0 -15px -15px 0;}.acbp-note-container.playing .acbp-note{display:block;}.acbp-note-container .acbp-note{display:none;opacity:0;width:16px;height:16px;position:absolute;z-index:999;}.acbp-note-container .acbp-note .icon{width:100%;height:100%;}.acbp-note-container #acbp-note1{animation:acbp-note-move-left1 2s linear 0s infinite normal;}@keyframes acbp-note-move-left1{0%{left:0;top:0;opacity:0;}50%{opacity:1;transform:rotate(9deg);}100%{left:200px;top:-90px;opacity:0;}}@keyframes acbp-note-move-right1{0%{right:0;top:0;opacity:0;}50%{opacity:1;transform:rotate(9deg);}100%{right:200px;top:-90px;opacity:0;}}.acbp-note-container #acbp-note2{animation:acbp-note-move-left2 2s linear 0.4s infinite normal;}@keyframes acbp-note-move-left2{0%{left:0;top:0;opacity:0;}50%{opacity:1;transform:rotate(-9deg);}100%{left:200px;top:-80px;opacity:0;}}@keyframes acbp-note-move-right2{0%{right:0;top:0;opacity:0;}50%{opacity:1;transform:rotate(-9deg);}100%{right:200px;top:-80px;opacity:0;}}.acbp-note-container #acbp-note3{animation:acbp-note-move-left3 2s linear 0.7s infinite normal;}@keyframes acbp-note-move-left3{0%{left:0;top:0;opacity:0;}50%{opacity:1;transform:rotate(9deg);}100%{left:200px;top:-70px;opacity:0;}}@keyframes acbp-note-move-right3{0%{right:0;top:0;opacity:0;}50%{opacity:1;transform:rotate(9deg);}100%{right:200px;top:-70px;opacity:0;}}";var $style=document.createElement("style");$style.rel="stylesheet";$style.innerHTML=css;document.head.appendChild($style)}},{key:"initControllerBar",value:function initControllerBar(){var _this=this;var $ctrlBar=this.$ap.querySelector(".aplayer-miniswitcher");var $ctrlBarParent=$ctrlBar.parentNode||$ctrlBar.parentElement;$ctrlBarParent.removeChild($ctrlBar);$ctrlBar=document.createElement("div");$ctrlBar.className="aplayer-miniswitcher";$ctrlBarParent=$ctrlBarParent.appendChild($ctrlBar);this.initPlayerMove($ctrlBar);$ctrlBar=document.createElement("div");$ctrlBar.className="acbp-ctrl-bar";$ctrlBarParent.appendChild($ctrlBar);var $minBtn=document.createElement("span");$minBtn.title="Minimize";$minBtn.className="acbp-ctrl-btn minimize";$minBtn.addEventListener("click",function(event){_this.minimizePlayer();event.stopPropagation()});$ctrlBar.appendChild($minBtn);var $maxBtn=document.createElement("span");$maxBtn.title="Maximize";$maxBtn.className="acbp-ctrl-btn maximize";$maxBtn.addEventListener("click",function(event){_this.maximizePlayer(event);event.stopPropagation()});$ctrlBar.appendChild($maxBtn);var $closeBtn=document.createElement("span");$closeBtn.title="Close";$closeBtn.className="acbp-ctrl-btn close";$closeBtn.addEventListener("click",function(event){_this.player.destroy();event.stopPropagation()});$ctrlBar.appendChild($closeBtn)}},{key:"initPlayerMove",value:function initPlayerMove($parentElem){var _this2=this;var $elem=document.createElement("div");$elem.className="acbp-move-box";$elem.addEventListener("mousedown",function(e){document.body.style.cursor="move";var strLeft=_this2.$ap.style.left||"0";var strBottom=_this2.$ap.style.bottom||"0";var offsetLeft=e.clientX-parseInt(strLeft,10);var offsetBottom=document.body.clientHeight-e.clientY-parseInt(strBottom,10);window.onmousemove=function(e1){_this2.movePlayer(e1,_this2.$ap,_this2.$apBody,offsetLeft,offsetBottom)};window.onmouseup=function(e2){document.body.style.cursor="default";_this2.playerStop(e2);_this2.noteAutoControl();window.onmousemove=window.onmouseup=undefined}});$parentElem.appendChild($elem)}},{key:"initPlayerEvent",value:function initPlayerEvent(){var _this3=this;this.player.on("listshow",function(){return setTimeout(function(){return _this3.playerStop()},500)});this.player.on("play",function(){return _this3.noteAutoControl()});this.player.on("pause",function(){return _this3.noteAutoControl()})}},{key:"movePlayer",value:function movePlayer(event,$apElem,$apBodyElem,offsetLeft,offsetBottom){this.event=event||window.event||this.event;var curLeft=this.event.clientX-offsetLeft;var curBottom=document.body.clientHeight-this.event.clientY-offsetBottom;this.curStop.left=curLeft;this.curStop.bottom=curBottom;$apElem.style.left=$apBodyElem.style.left=curLeft+"px";$apElem.style.bottom=$apBodyElem.style.bottom=curBottom+"px"}},{key:"playerStop",value:function playerStop(event){var apWidth=Math.max(66,this.$apBody.clientWidth)+18;var apHeight=Math.max(66,this.$ap.clientHeight);var bottom=void 0;if(this.curStop.bottom<16){bottom="0"}else{if(this.curStop.bottom+apHeight+16>document.body.clientHeight){bottom=document.body.clientHeight-apHeight}}if(bottom!==undefined){this.$ap.style.bottom=this.$apBody.style.bottom=bottom+"px"}var left=void 0;if(this.curStop.left<16){left="0"}else{if(this.curStop.left+apWidth+16>document.body.clientWidth){left=document.body.clientWidth-apWidth+18}}if(left!==undefined){this.$ap.style.left=this.$apBody.style.left=left+"px"}if(bottom||left){this.event=event||window.event||this.event;this.curStop.bottom=this.lastStop.bottom=bottom?bottom:document.body.clientHeight-this.event.clientY-apHeight;this.curStop.left=this.lastStop.left=left?left:this.event.clientX-apWidth}}},{key:"minimizePlayer",value:function minimizePlayer(){var _this4=this;this.setPlayerMode("mini");if(this.curStop.left+""==="0"&&this.curStop.bottom+""==="0"){return}this.$ap.style.background="none";this.$apBody.style.transition="all .5s";this.$ap.style.left=this.$apBody.style.left="0px";this.$ap.style.bottom=this.$apBody.style.bottom="0px";this.lastStop=_extends({},this.curStop);this.curStop.left=this.curStop.bottom=0;setTimeout(function(){_this4.$apBody.style.transition="padding .25s";_this4.noteAutoControl()},500)}},{key:"maximizePlayer",value:function maximizePlayer(event){var _this5=this;this.setPlayerMode(this.player.mode==="mini"?"normal":"mini");var isListHidden=this.$apList.className.indexOf("aplayer-list-hide")>-1;if(!isListHidden){this.$apList.className="aplayer-list aplayer-list-hide"}this.$apBody.style.transition="all .5s";if(this.curStop.left+""==="0"&&this.curStop.bottom+""==="0"){this.$ap.style.left=this.$apBody.style.left=this.lastStop.left+"px";this.$ap.style.bottom=this.$apBody.style.bottom=this.lastStop.bottom+"px";this.curStop=_extends({},this.lastStop)}setTimeout(function(){_this5.$apBody.style.transition="padding .25s";_this5.$ap.style.background="#fff";if(!isListHidden){_this5.$apList.className="aplayer-list"}_this5.noteAutoControl();_this5.playerStop(event)},500)}},{key:"initNote",value:function initNote(){if(!this.showNote){return}var $noteContainer=document.createElement("div");$noteContainer.className="acbp-note-container";var animationNamePrefix=this.curStop.left>document.body.clientWidth>>1?"acbp-note-move-right":"acbp-note-move-left";for(var i=1;i<4;i++){var $note=document.createElement("div");$note.id="acbp-note"+i;$note.className="acbp-note";$note.innerHTML='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="32" height="32"><path d="M1023.962 64.037c0-43.42-42.2-74.019-83.199-61.019L300.795 192.015c-26.6 8.4-44.8 33-44.8 60.999v522.83c-20.1-4.76-41.439-7.84-63.998-7.84C85.958 768.005 0 825.305 0 896.003S85.958 1024 191.997 1024s191.996-57.299 191.996-127.998V428.631l511.991-150.038v369.254c-20.1-4.76-41.44-7.84-63.999-7.84-106.038 0-191.996 57.299-191.996 127.998s85.958 127.997 191.996 127.997 191.997-57.299 191.997-127.997l-.02-703.968z"/></svg>';$note.querySelector("svg path").style.fill=this.randomRGBColor();$note.style.animationName=animationNamePrefix+i;$noteContainer.appendChild($note)}this.$ap.querySelector(".aplayer-pic").appendChild($noteContainer)}},{key:"noteAutoControl",value:function noteAutoControl(){if(!this.showNote){return}var $noteContainer=this.$ap.querySelector(".acbp-note-container");if($noteContainer){$noteContainer.className=this.player.audio.paused?"acbp-note-container":"acbp-note-container playing";var animationNamePrefix=this.curStop.left>document.body.clientWidth>>1?"acbp-note-move-right":"acbp-note-move-left";for(var i=1;i<4;i++){var noteElem=document.getElementById("acbp-note"+i);noteElem.style.animationName=animationNamePrefix+i;if(!this.player.audio.paused){noteElem.querySelector("svg path").style.fill=this.randomRGBColor()}}}else{this.initNote();if(!this.player.audio.paused){this.$ap.querySelector(".acbp-note-container").className="acbp-note-container playing"}}}},{key:"setPlayerMode",value:function setPlayerMode(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"normal";this.$apList.style.display="block";var $apListOl=this.$apList.querySelector("ol");if(mode==="normal"){var mh=this.player.options.listMaxHeight;this.$apList.style.maxHeight=mh||"250px";$apListOl.style.maxHeight=mh||"250px"}else{this.$apList.style.maxHeight="0px";$apListOl.style.maxHeight="0px"}this.player.setMode(mode)}},{key:"randomRGBColor",value:function randomRGBColor(){return"rgb("+Math.round(Math.random()*255)+","+Math.round(Math.random()*255)+","+Math.round(Math.random()*255)+")"}},{key:"consoleInfo",value:function consoleInfo(){console.log("\n %c APlayer-Control-Bar-Plugin %c https://github.com/snwjas/Aplayer-ControlBarPlugin \n","color:#fadfa3;background:#030307;padding:5px 0;","background:#fadfa3;padding:5px 0;")}}]);return Movadsorbent}();
